<html>
    <head>
        <title>A test</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>		
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css">
		<style>
		canvas{
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
		</style>
        <script>
        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgba(255, 159, 64,0.5)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgba(75, 192, 192,0.3)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgba(153, 102, 255,0.3)',
            grey: 'rgb(201, 203, 207)',
            ltred: 'rgb(255, 99, 132)',
            ltorange: 'rgba(255, 159, 64,0.3)',
            ltyellow: 'rgb(255, 205, 86)',
            ltgreen: 'rgb(75, 192, 192)',
            ltblue: 'rgb(54, 162, 235)',
            ltpurple: 'rgba(153, 102, 255,0.6)',
            ltgrey: 'rgb(201, 203, 207)'
        };
var sqlCasesData = {labels: ['2020-03-04','2020-03-05','2020-03-06','2020-03-07','2020-03-08','2020-03-09','2020-03-10','2020-03-11','2020-03-12','2020-03-13','2020-03-14','2020-03-15','2020-03-16','2020-03-17','2020-03-18','2020-03-19','2020-03-20','2020-03-21','2020-03-22','2020-03-23','2020-03-24','2020-03-25','2020-03-26','2020-03-27','2020-03-28','2020-03-29','2020-03-30','2020-03-31','2020-04-01','2020-04-02','2020-04-03','2020-04-04','2020-04-05','2020-04-06','2020-04-07','2020-04-08','2020-04-09','2020-04-10','2020-04-11','2020-04-12','2020-04-13','2020-04-14','2020-04-15','2020-04-16','2020-04-17','2020-04-18','2020-04-19','2020-04-20','2020-04-21','2020-04-22','2020-04-23','2020-04-24','2020-04-25','2020-04-26','2020-04-27','2020-04-28','2020-04-29','2020-04-30','2020-05-01','2020-05-02','2020-05-03','2020-05-04','2020-05-05','2020-05-06','2020-05-07','2020-05-08','2020-05-09','2020-05-10','2020-05-11','2020-05-12','2020-05-13','2020-05-14','2020-05-15','2020-05-16','2020-05-17','2020-05-18','2020-05-19'],
    totalcases: [1,2,4,4,6,11,15,23,29,50,75,98,176,268,427,735,896,1336,1914,2844,3675,4402,6876,8825,11124,13386,16636,18696,22255,25590,29895,34124,37505,41090,44416,47437,51027,54588,58151,61850,64584,68824,71030,75317,78467,81420,85301,88797,92387,95411,99989,102196,105523,109038,111188,113856,116264,118652,121190,123717,126744,128269,130593,131890,133635,135454,137085,138532,139945,140743,141560,142704,143905,145089,146334,148039,149037],
    cases7days: [,,,,,,,10,11,15,29,33,102,155,280,612,771,1189,1711,2615,3377,3940,6135,7926,9785,11472,13792,15021,17853,18714,21070,23000,24119,24773,27183,28332,29307,28849,27038,26892,25812,24926,23766,24290,23879,23445,24140,24756,24666,24979,24672,23916,24294,23737,22391,21469,20853,19293,18994,18194,17746,17252,16905,15649,14983,14294,13487,11838,11676,10150,9670,9069,8451,8004,7802,8094,8294],
    cases14days: [,,,,,,,,,,,,,,132,295,353,373,568,1389,1763,2311,5994,8194,10509,12659,16130,18220,21602,24804,28974,32763,35591,38246,40741,43035,44633,47098,48581,50210,50585,52109,52098,53545,52658,50483,51032,50568,49592,48745,48962,47725,47739,47781,46989,46016,45806,43905,42859,42369,41443,39485,38255,36479,34202,33258,31562,29584,28846,26901,25296,24052,22715,21372,19590,19770,18444],
    casesToday: [,1,1,0,1,1,2,6,3,20,24,23,73,89,156,305,160,440,577,930,831,727,2474,1949,2299,2262,3250,2217,3559,3335,4366,5099,3495,3885,4627,3879,3956,3908,3563,3699,2805,4240,2719,4428,3479,2953,4044,3496,3651,3032,4578,2783,3327,3515,2150,2768,2509,2527,2538,2527,3062,1525,2421,1297,1787,1819,1631,1447,1413,823,859,1214,1201,1184,1292,1819,1031]
};
var sqlDeathsData = {labels: ['2020-03-04','2020-03-05','2020-03-06','2020-03-07','2020-03-08','2020-03-09','2020-03-10','2020-03-11','2020-03-12','2020-03-13','2020-03-14','2020-03-15','2020-03-16','2020-03-17','2020-03-18','2020-03-19','2020-03-20','2020-03-21','2020-03-22','2020-03-23','2020-03-24','2020-03-25','2020-03-26','2020-03-27','2020-03-28','2020-03-29','2020-03-30','2020-03-31','2020-04-01','2020-04-02','2020-04-03','2020-04-04','2020-04-05','2020-04-06','2020-04-07','2020-04-08','2020-04-09','2020-04-10','2020-04-11','2020-04-12','2020-04-13','2020-04-14','2020-04-15','2020-04-16','2020-04-17','2020-04-18','2020-04-19','2020-04-20','2020-04-21','2020-04-22','2020-04-23','2020-04-24','2020-04-25','2020-04-26','2020-04-27','2020-04-28','2020-04-29','2020-04-30','2020-05-01','2020-05-02','2020-05-03','2020-05-04','2020-05-05','2020-05-06','2020-05-07','2020-05-08','2020-05-09','2020-05-10','2020-05-11','2020-05-12','2020-05-13','2020-05-14','2020-05-15','2020-05-16','2020-05-17','2020-05-18','2020-05-19'],
    totaldeaths: [0,0,0,0,0,0,1,1,1,1,2,2,3,3,5,9,11,16,20,27,51,69,89,115,147,161,206,274,362,539,647,847,917,1005,1233,1504,1706,1932,2183,2350,2443,2805,3156,3518,3840,4070,4202,4377,4753,5063,5368,5617,5863,5938,6044,6442,6770,7228,7538,7742,7871,7910,8244,8549,8801,8952,9116,9255,9310,9508,9702,9946,10138,10249,10356,10435,10586],
    deaths7days: [,,,,,,,1,1,1,1,1,3,2,4,8,10,14,17,23,48,63,79,104,131,141,179,223,293,453,535,700,766,799,961,1145,1167,1287,1345,1442,1450,1575,1654,1821,1908,1887,1854,1935,1950,1907,1851,1780,1795,1736,1668,1689,1709,1862,1921,1879,1933,1866,1802,1779,1573,1414,1374,1384,1400,1264,1153,1145,1187,1133,1101,1125,1078],
    deathsToday: [,0,0,0,0,0,1,0,0,0,1,0,1,0,2,4,2,5,4,7,24,18,20,26,32,14,59,68,88,180,108,200,70,88,237,272,204,236,251,167,93,362,351,362,322,231,134,175,377,310,305,252,246,75,106,398,329,458,310,204,129,40,334,305,252,151,165,140,55,198,194,244,192,111,107,79,151]
};

        window.onload = function() {
                document.getElementById("theHeader").innerText = "COVID-19 Charts";

                var casesCtx = document.getElementById("casesChart");
                var casesChart = new Chart(casesCtx, {
                    // The type of chart we want to create
                    type: 'line',

                    // The data for our dataset
                    data: {
                        labels: sqlCasesData.labels,
                        datasets: [{
                            label: 'Total Cases',
                            backgroundColor: chartColors.red,
                            borderColor: chartColors.ltred,
                            fill: false,
                            yAxisID: 'leftAxis',
                            data: sqlCasesData.totalcases
                        },{
                            label: 'New Cases Past 14 Days',
                            backgroundColor: chartColors.purple,
                            borderColor: chartColors.ltpurple,
                            fill: true,
                            yAxisID: 'leftAxis',
                            data: sqlCasesData.cases14days
                        },{
                            type: 'bar',
                            label: 'New Cases Today',
                            backgroundColor: chartColors.green,
                            borderColor: chartColors.ltgreen,
                            fill: true,
                            yAxisID: 'rightAxis',
                            data: sqlCasesData.casesToday
                        }]

                    },
                    // Configuration options go here
                    options: {
                        scales: {
                            yAxes : [
                                {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    id: 'leftAxis',
                                    scaleLabel:
                                    {
                                        display: true,
                                        labelString: 'Total Cases / Active Cases (New Cases Past 14 Days)'
                                    }
                                },
                                {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    id: 'rightAxis',
                                    scaleLabel:
                                    {
                                        display: true,
                                        labelString: 'New Cases Today'
                                    }
                                }
                            ]
                        },
                        plugins: {
                            deferred: {
                                xOffset: 150,
                                yOffset: '50%',
                                delay: 500
                            }
                        }
                    }
                });


                var deathsCtx = document.getElementById("deathsChart");
                var deathsChart = new Chart(deathsCtx, {
                    // The type of chart we want to create
                    type: 'line',

                    // The data for our dataset
                    data: {
                        labels: sqlDeathsData.labels,
                        datasets: [{
                            label: 'Deaths',
                            backgroundColor: chartColors.purple,
                            borderColor: chartColors.ltpurple,
                            fill: false,
                            yAxisID: 'leftAxis',
                            data: sqlDeathsData.totaldeaths
                        },{
                            label: 'Deaths This Week',
                            backgroundColor: chartColors.green,
                            borderColor: chartColors.ltgreen,
                            fill: true,
                            yAxisID: 'leftAxis',
                            data: sqlDeathsData.deaths7days
                        },{
                            type: 'bar',
                            label: 'Deaths Today',
                            backgroundColor: chartColors.orange,
                            borderColor: chartColors.ltorange,
                            fill: true,
                            yAxisID: 'rightAxis',
                            data: sqlDeathsData.deathsToday
                        }]

                    },
                    // Configuration options go here
                    options: {
                        scales: {
                            yAxes : [
                                {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    id: 'leftAxis',
                                    scaleLabel:
                                    {
                                        display: true,
                                        labelString: 'Deaths / Deaths This Week'
                                    }
                                },
                                {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    id: 'rightAxis',
                                    scaleLabel:
                                    {
                                        display: true,
                                        labelString: 'Deaths Today'
                                    }
                                }
                            ]
                        },
                        plugins: {
                            deferred: {
                                xOffset: 150,
                                yOffset: '50%',
                                delay: 500
                            }
                        }
                    }
                });

                var xyData = [];
                for(i = 0, j = 0; i < sqlCasesData.totalcases.length; i++) {
                    if(isNaN(sqlCasesData.cases7days[i])) {
                        j = sqlCasesData.totalcases[i];
                    }
                    else {
                        j = sqlCasesData.cases7days[i];
                    }
                    xyData[i] = {x: sqlCasesData.totalcases[i], y: j};
                }

                var trajCtx = document.getElementById("trajectoryChart");
                var trajChart = Chart.Scatter(trajCtx, {
                    // The data for our dataset
                    data: {
                        datasets: [{
                            label: 'Total Cases',
                            backgroundColor: chartColors.red,
                            borderColor: chartColors.ltred,
                            fill: false,
                            data: xyData,
                            snapGaps: true,
                            showLine: true,
                            lineTension: 0,
                        }]

                    },
                    // Configuration options go here
                    options: {
                        scales: {
                            xAxes : [
                                {
                                    type: 'logarithmic',
                                    display: true,
                                    position: 'bottom',
                                    ticks: {
                                        min:0,
                                        userCallback: function(tick) {
                                            return Number(tick).toLocaleString();
                                        }
                                    }
                                }
                            ],
                            yAxes : [
                                {
                                    type: 'logarithmic',
                                    display: true,
                                    position: 'left',
                                    id: 'leftAxis',
                                    scaleLabel:
                                    {
                                        display: true,
                                        labelString: 'Total Cases / Active Cases (New Cases Past 14 Days)'
                                    },
                                    ticks: {
                                        min:0,
                                        userCallback: function(tick) {
                                            return Number(tick).toLocaleString();
                                        }
                                    }
                                }
                            ]
                        },
                        plugins: {
                            deferred: {
                                xOffset: 150,
                                yOffset: '50%',
                                delay: 500
                            }
                        }
                    }
                });
            }
        </script>
    </head>
    <body>
        <h1 id="theHeader">This is broken</h1>
        <div style="width:90%">
            <h2>Trajectory</h2>
            <canvas id="trajectoryChart"></canvas>
        </div>
        <div style="width:90%">
            <h2>Cases/New Cases/Active Cases</h2>
            <canvas id="casesChart"></canvas>
        </div>
        <div style="width:90%">
            <h2>Deaths/Deaths Today/Deaths This Week</h2>
            <canvas id="deathsChart"></canvas>
        </div>
    </body>
</html>